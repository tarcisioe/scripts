#!/bin/bash

source scriptlib-init

require notify
require path-util
require util


usage() {
echo "\
Usage: $(script-name) [OPTION...]
Show the battery level as a notification.

Optional arguments:
    -h/--help     Print this help message and exit."
}


battery-symbol() {
    local status="${1}"
    local batt="${2}"

    (($status == 1)) && { printf ''; return; }

    (($batt <= 25)) && { printf ''; return; }
    (($batt <= 50)) && { printf ''; return; }
    (($batt <= 75)) && { printf ''; return; }

    printf ''
}


battstatus() {
    local batt
    batt=$(<$(first-file-of /sys/class/power_supply/BAT?/capacity))

    local status
    status=$(<$(first-file-of /sys/class/power_supply/ADP?/online))

    local symbol
    symbol="$(battery-symbol "${status}" "${batt}")"

    echo "${symbol} ${batt}%"
}


main() (
    set -e

    local options
    options=$(getopt -o h -l help -- "$@")
    eval set -- "$options"

    while true; do
        case "$1" in
            -h|--help)
                usage && exit 0
                ;;
            --) shift ;&
            *) break ;;
        esac
        shift
    done

    battstatus
)


wrap-shortcut main "$@"
