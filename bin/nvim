#!/bin/bash

source scriptlib-init

require dependencies
require wrap


rename-tty() {
    local name="${1}"

    echo -ne "\033]0;${name}\007"
}


ping-i3() {
    i3 --get-socketpath > /dev/null &&
        i3-msg mode default > /dev/null
}


rename-and-ping() {
    local name="${1}"

    rename-tty "${name}"
    sleep 0.01
    ping-i3
}


current-title() {
    xprop -id "${WINDOWID}" WM_NAME | cut -f 2 -d "=" | xargs echo
}


main() {
    local title="$(current-title)"
    rename-and-ping "VIM" || true
    wrap-no-exec "$@"
    rename-and-ping "$title" || true
}


check-dependencies i3 i3-msg
main "$@"
